--- 
- 
  become: true
  hosts: ubuntu
  tasks: 
    - 
      apt: "name=apache2 update_cache=yes state=latest"
      name: "install apache2"
    - 
      apt: name=libapache2-mod-wsgi
      name: "install mod_wsgi"
    - 
      apt: name=python-dev
      name: "install python-dev"
    -
      shell: a2enmod wsgi
      name: "enable a2enmod wsgi"
    - 
      name: Creates directory
      file:
        path: /var/www/FlaskApp
        state: directory
    -
      name: Creates directory
      file:
        path: /var/www/FlaskApp/FlaskApp
        state: directory
    -
      name: Creates directory
      file:
        path: /var/www/FlaskApp/FlaskApp/static
        state: directory
    -
      name: Creates directory
      file:
        path: /var/www/FlaskApp/FlaskApp/templates
        state: directory
    - 
      apt: name=python-setuptools
      name: "installs python setup tools"
    - 
      apt: name=python-pip
      name: "install pip"
    -
      pip:
        name: virtualenv
      name: "install venv"
    -
      shell: virtualenv /var/www/FlaskApp/FlaskApp/venv
      name: "create venv"
    -
      shell: . /var/www/FlaskApp/FlaskApp/venv/bin/activate
      name: "activate venv" 
    -
      pip:
        name: Flask
      name: "install Flask"
    -
      copy:
        src: __init__.py
        dest: /var/www/FlaskApp/FlaskApp/__init__.py
        mode: '0777'
      name: "copy __init__.py"
    -
      template:
        src: FlaskApp.j2
        dest: /etc/apache2/sites-available/FlaskApp.conf
        mode: '0777'
      name: "transfer conf file"
    -
      template:
        src: flaskapp.j2
        dest: /var/www/FlaskApp/flaskapp.wsgi
        mode: '0777'
      name: "transfer wsgi file"
    -
      shell: /usr/sbin/a2ensite FlaskApp
    - 
      name: Ansible delete directory
      file:
        path: /var/www/html
        state: absent
    - 
      name: Ansible delete file
      file:
        path: /etc/apache2/sites-enabled/000-default.conf
        state: absent
    - 
      name: Ansible delete file
      file:
        path: /etc/apache2/sites-available/default-ssl.conf
        state: absent
    - 
      name: Ansible delete file 
      file:
        path: /etc/apache2/sites-available/000-default.conf
        state: absent
    -
      systemd:
        name: apache2
        daemon_reload: yes
        state: restarted
      name: "Restart apache"
...

